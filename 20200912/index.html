<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="js/jquery-2.1.3.min.js"></script>
    <title>LINE風アプリ</title>
</head>
<body>
    
<!-- ヘッダー -->
<div id="header">
    <div id="header_inbox">
        <div id="allow">く</div>
        <div id="room">LINE風チャットアプリ</div>
        <!-- <div id="login">ログイン</div> -->
    </div>
</div>

<!-- タイムライン -->
<div id="timeline">
    <div id="date_area"><span id="date">6/20(水)</span></div>
    <div id="msg_box_r">
        <div id="time">22:00</div>
        <div id="msg_g">吹き出し</div>
    </div>

    <div id="date_area"><span id="date">6/20(水)</span></div>
    <div id="msg_box">
        <div><img src="./img/icon.png" alt="" id="icon"></div>
        <div id="msg_box_l">            
            <div id="time">22:00</div>
            <div id="msg_inbox">
                <div id="name">name</div>
                <div id="msg_w">吹き出し</div>
            </div>
        </div>
    </div>

    <div id="date_area"><span id="date">6/20(水)</span></div>
    <div id="msg_box_r">
        <div id="time">22:00</div>
        <div id="msg_g">吹き出し</div>
    </div>

    <div id="date_area"><span id="date">6/20(水)</span></div>
    <div id="msg_box">
        <div><img src="./img/icon.png" alt="" id="icon"></div>
        <div id="msg_box_l">            
            <div id="time">22:00</div>
            <div id="msg_inbox">
                <div id="name">name</div>
                <div id="msg_w">吹き出し</div>
            </div>
        </div>
    </div>

    <div id="date_area"><span id="date">6/20(水)</span></div>
    <div id="msg_box_r">
        <div id="time">22:00</div>
        <div id="msg_g">吹き出し吹き出し吹き出し吹き出し吹き出し吹き出し吹き出し吹き出し吹き出し吹き出し吹き出し吹き出し吹き出し</div>
    </div>
</div>

<!-- フッター -->
<div id="footer">
    <div id="footer_inbox">
        <label>
            <img src="./img/roll.png">
            <input type="file" id="file">
        </label>
        <div id="text"><input type="text" placeholder="メッセージを入力" id="input" autocomplete="off"></div>
        <div id="send"><img src="./img/send.png" alt=""></div>
    </div>
</div>





<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.20.0/firebase.js"></script>

<script>
// ---------------------------------------------
//   Firebase
// ---------------------------------------------
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyD8KDvPgNwMliN6ki8Eywp0aHHQvJ47c5A",
    authDomain: "dev17-ce778.firebaseapp.com",
    databaseURL: "https://dev17-ce778.firebaseio.com",
    projectId: "dev17-ce778",
    storageBucket: "dev17-ce778.appspot.com",
    messagingSenderId: "858530821554",
    appId: "1:858530821554:web:2f2cd80d52b18bb599a0ab"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const ref = firebase.database().ref();
  


// ---------------------------------------------
//   ここから
// ---------------------------------------------

// 同日なら日付表示しない
// Googleログイン
// 1文字以上入力がないと送信ボタン押せないように
// デフォルトで最後までスクロール



// 関数定義
function send(){
    const text = $("#input").val();

    // ランダムな返答
    const r = Math.floor(Math.random()*5)
    const point = ["100点","60点","20点","0点","-50点"];
    const chat = point[r]

    //曜日配列
    let week   = ["日", "月", "火", "水", "木", "金", "土"];

    //日時取得
    let now = new Date();            //日付取得準備（必須）
    let month = now.getMonth() + 1;  //月+１を足す
    let day = now.getDate();        //日
    let w = now.getDay();          //曜日（数値）
    let h = now.getHours();          //時
    let m = now.getMinutes();        //分

    //日時表示文字列の作成
    let date = month+"/"+day+"("+week[w]+")";
    let time = h + ":" + m;

    //name,iconは定義してない
    const msg ={
        text:text,
        date:date,
        time:time,
        chat:chat
        // name:name,
        // icon:icon        
    }

    ref.push(msg);
}


// テキスト送信orエンターの挙動
function scroll(){
    const lastElement = document.querySelector("#timeline").lastElementChild
    lastElement.scrollIntoView({behavior: "smooth"})
    const input = document.getElementById("input");
    input.value = '';
}



// クリックで文字を送信
$("#send").on("click",function(){
    send();
    scroll();
});

// Enterで文字を送信
$("#text").on("keydown",function(e){
    if(e.keyCode == 13){
        send();
        scroll();
        // console.log(e)
    }
});


// 受信処理
ref.on("child_added", function(data){ 
    const v = data.val(); 
    const k = data.key;
    console.log(v)



    // 表示するHTML
    const date = '<div id="date_area"><span id="date">'+v.date+'</span></div>';
    const mine = '<div id="msg_box_r"><div id="time">'+v.time+'</div><div id="msg_g">'+v.text+'</div></div>';
    const you ='<div id="msg_box"><div><img src="./img/icon.png" id="icon"></div><div id="msg_box_l"><div id="time">'+v.time+'</div><div id="msg_inbox"><div id="name">name</div><div id="msg_w">'+v.chat+'</div></div></div></div>'
    // if文でもし投稿日付が前の投稿とより多かったら日付を表示する
    // if文でもし投稿日付が前の投稿と一緒なら日付を表示しない

    $("#timeline").append(date);
    $("#timeline").append(mine);
    // 遅延で出るコメントのスクロールかわからないーーーーーーーー
    setTimeout(function(){
        $("#timeline").append(you);
    }, 2000);
});


// クリックアラート
$("#allow").on("click",function(){
    alert("何も起きません(;_;)");
});


$("#file").on("click",function(){
    alert("何も起きません(;_;)");
});





</script>



 
</body>
</html>