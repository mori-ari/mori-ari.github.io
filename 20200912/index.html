<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="js/jquery-2.1.3.min.js"></script>
    <title>LINE風アプリ</title>
</head>
<body>
    
<div id="header">
    <div id="header_inbox">
        <div id="allow">く</div>
        <div id="room">なまえ</div>
        <div id="login">ログイン</a> </div>
    </div>
</div>

<div id="timeline">
    <div id="date_area"><span id="date">6/20(水)</span></div>
    <div id="msg_box_r">
        <div id="time">22:00</div>
        <div id="msg_g">吹き出し</div>
    </div>

    <div id="date_area"><span id="date">6/20(水)</span></div>
    <div id="msg_box">
        <div><img src="./img/icon.png" alt="" id="icon"></div>
        <div id="msg_box_l">            
            <div id="time">22:00</div>
            <div id="msg_inbox">
                <div id="name">name</div>
                <div id="msg_w">吹き出し</div>
            </div>
        </div>
    </div>

    <div id="date_area"><span id="date">6/20(水)</span></div>
    <div id="msg_box_r">
        <div id="time">22:00</div>
        <div id="msg_g">吹き出し</div>
    </div>

    <div id="date_area"><span id="date">6/20(水)</span></div>
    <div id="msg_box">
        <div><img src="./img/icon.png" alt="" id="icon"></div>
        <div id="msg_box_l">            
            <div id="time">22:00</div>
            <div id="msg_inbox">
                <div id="name">name</div>
                <div id="msg_w">吹き出し</div>
            </div>
        </div>
    </div>

    <div id="date_area"><span id="date">6/20(水)</span></div>
    <div id="msg_box_r">
        <div id="time">22:00</div>
        <div id="msg_g">吹き出し吹き出し吹き出し吹き出し吹き出し吹き出し吹き出し吹き出し吹き出し吹き出し吹き出し吹き出し吹き出し</div>
    </div>
</div>


<div id="footer">
    <div id="footer_inbox">
        <div id="roll"><img src="./img/roll.png" alt=""></div>
        <div id="text"><input type="text" placeholder="メッセージを入力" id="input" autocomplete="off"></div>
        <div id="send"><img src="./img/send.png" alt=""></div>
    </div>
</div>





<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.20.0/firebase.js"></script>

<script>
// ---------------------------------------------
//   Firebase
// ---------------------------------------------
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyD8KDvPgNwMliN6ki8Eywp0aHHQvJ47c5A",
    authDomain: "dev17-ce778.firebaseapp.com",
    databaseURL: "https://dev17-ce778.firebaseio.com",
    projectId: "dev17-ce778",
    storageBucket: "dev17-ce778.appspot.com",
    messagingSenderId: "858530821554",
    appId: "1:858530821554:web:2f2cd80d52b18bb599a0ab"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const ref = firebase.database().ref();
  


// ---------------------------------------------
//   ここから
// ---------------------------------------------

// 同日なら日付表示しない
// 自分以外の投稿はスタイルを変える
// Googleログイン
// 1文字以上入力がないと送信ボタン押せないように
// 送信したらinput欄クリア

// 関数定義
function send(){
    const text = $("#input").val();

    //曜日配列
    let week   = ["日", "月", "火", "水", "木", "金", "土"];

    //日時取得
    let now = new Date();            //日付取得準備（必須）！！
    let month = now.getMonth() + 1;  //月+１を足す
    let day = now.getDate();        //日
    let w = now.getDay();          //曜日（数値）
    let h = now.getHours();          //時
    let m = now.getMinutes();        //分

    //日時表示文字列の作成
    let date = month+"/"+day+"("+week[w]+")";
    let time = h + ":" + m;

    //name,iconは定義してない
    const msg ={
        text:text,
        date:date,
        time:time,
        // name:name,
        // icon:icon
    }
    ref.push(msg);
}




// 文字を送信
$("#send").on("click",function(){
    send();
    const lastElement = document.querySelector("#timeline").lastElementChild
    lastElement.scrollIntoView({behavior: "smooth"})
});

  


// 受信処理
ref.on("child_added", function(data){ 
    const v = data.val(); 
    const k = data.key;
    const date = '<div id="date_area"><span id="date">'+v.date+'</span></div>';
    const mine = '<div id="msg_box_r"><div id="time">'+v.time+'</div><div id="msg_g">'+v.text+'</div></div>';
    const you ='<div id="msg_box"><div><img src="'+v.icon+'" id="icon"></div><div id="msg_box_l"><div id="time">'+v.time+'</div><div id="msg_inbox"><div id="name">'+v.name+'</div><div id="msg_w">'+v.text+'</div></div></div></div>'
    // if文でもし投稿日付が前の投稿とより多かったら日付を表示する
    // if文でもし投稿日付が前の投稿と一緒なら日付を表示しない
    $("#timeline").append(date,mine);
    // $("#timeline").append(date,you);

});

// イベント情報取得
$("#text").on("keydown",function(e){
    if(e.keyCode == 13){
        send();
    }
});











</script>



 
</body>
</html>